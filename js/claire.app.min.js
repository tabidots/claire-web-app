var claireApiServer="//learnengli.sh/api";helpTranslations={inputPrompt:{en:"Type your sentence here.",es:"Introduzca aquí una frase en inglés.",pt:"Digite aqui uma frase em inglês.",fr:"Tapez ici une phrase en anglais.",de:"Tippen Sie hier auf Englisch einen Satz.",jp:"ここに英語の文章を入力してください。",kr:"여기 영어 문장을 입녁하세요.","zh-CN":"在这里用英语输入句子。","zh-TW":"在這裡用英語輸入句子。",hi:"यहाँ इंग्लिश में वाक्य टाइप करें ।",ml:"ഇവിടെ ഇംഗ്ലിഷിൽ വാചകം ടൈപ്പ് ചെയ്യുക."},subject:{en:"subject",es:"sujeto",pt:"sujeito",fr:"sujet",de:"Subjekt",jp:"主語",kr:"주어","zh-CN":"主语","zh-TW":"主語",hi:"कर्ता",ml:"കർത്താവ്"},verb:{en:"verb",es:"verbo",pt:"verbo",fr:"verbe",de:"Verb",jp:"動詞",kr:"동사","zh-CN":"动词","zh-TW":"動詞",hi:"क्रिया",ml:"ക്രിയ"},object:{en:"object",es:"objeto",pt:"objeto",fr:"objet",de:"Objekt",jp:"目的語",kr:"목적어","zh-CN":"受词","zh-TW":"受詞",hi:"कारक",ml:"കർമ്മം"},tense:{en:"tense",es:"tiempo",pt:"tempo",fr:"temps",de:"Zeit",jp:"自制",kr:"텐스","zh-CN":"时态","zh-TW":"時態",hi:"काल",ml:"കാലം"},complexPhrase:{en:"a complex phrase",es:"una frase compleja",pt:"uma frase complexa",fr:"une phrase complexe",de:"ein komplex Satzteil,",jp:"複雑な節",kr:"복잡한 어절","zh-CN":"这复杂的短语","zh-TW":"這複雜的短語",hi:"मिश्रित उपवाक्य",ml:"ഈ സങ്കീര്ണ്ണമായ ഉപവാക്യത്തിന്"},modifyingPhrase:{en:"that has a modifying phrase",es:"que tiene una frase modificador",pt:"que tem uma frase modificador",fr:"qui a une phrase modificateur",de:"der einen Attributsatz habe",jp:"その節を修飾する節",kr:"그 어절을 수식하는 어절","zh-CN":"有修饰短语","zh-TW":"有修飾短語",hi:"जिस के पास अश्रित उपवाक्य है",ml:"ആശ്രിത ഉപവാക്യമുണ്ട്"},purpleWords:{en:"purple words",es:"palabras moradas",pt:"palavras roxas",fr:"mots violets",de:"lila Wörter",jp:"すみれ色の言葉",kr:"보라색 단어","zh-CN":"雪青色的单词","zh-TW":"雪青色的單詞",hi:"बैंगनी में शब्द",ml:"പർപ്പിളിലുള്ള\nവാക്കുകൾ"},orangeWords:{en:"orange words",es:"palabras naranjas",pt:"palavras laranjas",fr:"mots oranges",de:"orange Wörter",jp:"オレンジ色の単語",kr:"주황색 단어","zh-CN":"橘黄色的单词","zh-TW":"橘黃色的單詞",hi:"नारंगी में शब्द",ml:"ഓറഞ്ചിലുള്ള\nവാക്കുകൾ"},seeMoreInfo:{en:"see more information\nabout your entry",es:"ver más informaciones\nsobre su frase",pt:"ver mais informações\nsobre a sua frase",fr:"voir plus d'informations\nsur votre phrase",de:"weitere Informationen\nüber Ihren Satz sehen",jp:"文章の詳細を見る",kr:"문장의 상세한 것을 보다","zh-CN":"显示句子的详细信息","zh-TW":"顯示句子的詳細信息",hi:"इस अभिलेख के बारेमें\nविस्तार से जानना",ml:"വാചകത്തിനെ കുറിച്ചുള്ള\nകൂടുതൽ വിവരങ്ങൾക്ക്"},copyToClipboard:{en:"copy to clipboard",es:"copiar al portapapeles",pt:"copiar para o clipboard",fr:"copier dans le presse-papiers",de:"in Zwischenablage kopieren",jp:"クリップボードにコピー",kr:"클립보드에 카피하다","zh-CN":"复制到剪贴板","zh-TW":"複製到剪貼板",hi:"क्लिपबोर्ड पे कॉपी करना",ml:"ക്ലിപ്പ്ബോർഡിലേക്ക്\nകോപ്പി ചെയ്യുക"}};function getStyle(b,c){var a=window.getComputedStyle(b,null).getPropertyValue(c);return(/^\d+/.test(a))?parseInt(a,10):a}function clearSelection(){if(document.selection){document.selection.empty()}else{if(window.getSelection){window.getSelection().removeAllRanges()}}}function isDescendantOfClass(c,a){var b=c.parentNode;while(b!=null&&b!=document){if(b.classList.contains(a)){return true}b=b.parentNode}return false}function mousewheelCompatibility(a){if(!a){a=window.event}a.deltaY=-a.wheelDelta;wheelHandler(a)}function wheelHandler(f){var b=document.getElementsByTagName("html")[0],d=0,a=0,c;if(c>Math.abs(f.deltaY)||!c){c=Math.abs(f.deltaY)}if(f.stopPropagation){f.stopPropagation()}else{f.cancelBubble=true}if((f.deltaY<0&&this.scrollTop===0)||(f.deltaY>0&&this.scrollHeight===this.scrollTop+this.clientHeight)){if(f.preventDefault){f.preventDefault()}else{f.returnValue=false}}else{if(!a){d=b.scrollTop}a++;setTimeout(function(){a--;if(!a&&b.scrollTop!==d){b.scrollTop=d}},0)}}function confineScroll(a){isIE8=document.createElement("a");if(a.removeWheelListener){return}isIE8.innerHTML="<!--[if IE 8]><span></span><![endif]-->";isIE8=isIE8.children.length>0;if(a.addEventListener&&!isIE8){a.addEventListener("wheel",wheelHandler,false);a.addEventListener("mousewheel",mousewheelCompatibility,false);a.removeWheelListener=function(){a.removeEventListener("wheel",wheelHandler,false);a.removeEventListener("mousewheel",mousewheelCompatibility,false);a.removeWheelListener=undefined}}else{if(a.attachEvent){a.attachEvent("onmousewheel",mousewheelCompatibility);a.removeWheelListener=function(){a.detachEvent("onmousewheel",wheelHandler);a.removeWheelListener=undefined}}}}function positionAnnotationBlock(l,d){var e=d.style;if(e.display==="block"){return}e.left=(l.offsetWidth/2)+"px";e.display="block";var k=d.classList.contains("paragraph-annotations"),f=d.getBoundingClientRect(),h=window.innerWidth;if(k){e.left="-250px"}else{if(f.right>h){var c=f.right-h;e.left=(l.offsetWidth/2-c-20)+"px"}}var a=document.getElementById("output"),i=document.querySelector("footer").offsetHeight,b=document.querySelector("footer").offsetTop,g=getStyle(a,"padding-top"),j=window.innerHeight-i-g;if(f.height>j){e.height=(j-25)+"px";e.overflowY="scroll";e.top=(g-f.top+70)+"px";if(k){_.defer(function(){e.left="-270px"})}confineScroll(d);return}if(k){e.top="-20px"}if(f.bottom>b){var c=f.bottom-b;e.top=(i-c)+"px"}}var blanket=document.getElementById("blanket");var fixedFace=document.getElementById("fixed-claire-face");function focusOnInput(){document.getElementById("input-box").focus();blanket.classList.add("show");if(!document.querySelector("#input .claire-face").offsetParent){fixedFace.classList.add("show")}if(!_.isUndefined(myVue.helpIsOn)){myVue.helpIsOn=false}}function hideBlanket(){_.map([blanket,fixedFace],function(a){a.classList.remove("show")})}function resizeInput(){var d=document.getElementById("input-box"),c=d.value?d.scrollHeight:getStyle(d,"min-height");d.style.height=c+"px";d.parentNode.style.height=(c+20)+"px";var f=getStyle(document.querySelector("#input-left"),"display")==="none",b=document.getElementById("output"),e=parseInt(d.parentNode.style.height,10),h=f?document.querySelector("#input-right .bubble"):document.querySelector("#input-left"),a=f?getStyle(h,"min-height"):getStyle(h,"min-height")+getStyle(h,"padding-top"),g=f?50:0;b.style.paddingTop=(Math.max(a,e)+g)+"px";if(!("ontouchstart" in window)){zenscroll.toY(0)}}var lazyResize=_.debounce(resizeInput,200);Vue.filter("markdown",function(a){return smartquotes(micromarkdown.parse(a))});Vue.use(VueTouch);var Annotation=Vue.extend({template:"#annotation",props:["paraIndex","sentIndex","syntagmaIndex","annotation"],ready:function(){var a=this.$el.parentNode.parentNode,b=this.$el.parentNode;if(!a){return}positionAnnotationBlock(a,b)}});var Syntagma=Vue.extend({template:"#syntagma",props:["paraIndex","sentIndex","syntagmaIndex","syntagma"],components:{annotation:Annotation},data:function(){return{showingLabel:false,showingAnnotations:false,highlightStatus:{active:false,subject:false,object:false,dependent:false}}},computed:{height:function(){return this.syntagma.height?this.syntagma.height:0}},methods:{unfocus:function(){this.showingLabel=false;this.$dispatch("triggerHighlights")},focus:function(){this.showingLabel=true;this.$dispatch("triggerHighlights",this)},unfocusAndFocus:function(b){if(isDescendantOfClass(b.target,"annotation-block")){}else{if(this.showingLabel&&/Android/.test(navigator.userAgent)&&this.$el.contains(b.target)){return}else{this.$parent.$parent.$broadcast("reset");b.preventDefault()}}this.$parent.$parent.$broadcast("noLabels");var a=this;_.defer(function(){a.focus()})},showAnnotations:function(){this.$parent.$parent.$broadcast("reset");this.$parent.$parent.$emit("hideHelp");this.showingAnnotations=true}},events:{noLabels:function(){this.showingLabel=false},reset:function(){this.showingAnnotations=false}}});var ParagraphInfo=Vue.extend({template:"#paragraph-info",props:["paraIndex","original","firstpass","allchanges","annotationCount","entryNumber","revision"],ready:function(){var a=this.$el.parentNode.parentNode,b=this.$el.parentNode;if(!a){return}positionAnnotationBlock(a,b)}});var Paragraph=Vue.extend({template:"#paragraph",components:{syntagma:Syntagma,"paragraph-info":ParagraphInfo,annotation:Annotation},data:function(){return{showingMobileAnnotations:false,showingParagraphInfo:false,copyboxExists:false,showingCopybox:false,showingSuccessbox:false,iOS:(/iP/.test(navigator.userAgent))}},computed:{entryNumber:function(){return this.totalParagraphs-this.paraIndex},allAnnotations:function(){anns=[];_.each(this.paragraph,function(a){_.each(a,function(b){anns=anns.concat(b.annotations)})});return anns},annotationCount:function(){var b=_.pluck(this.allAnnotations,"type");var a=_.countBy(_.sortBy(b));return a},noAnnotations:function(){return this.allAnnotations.length===0}},events:{reset:function(){this.showingParagraphInfo=false;return true},resetMobileAnnotations:function(){this.showingMobileAnnotations=false},noLabels:function(){this.$emit("triggerHighlights");return true},triggerHighlights:function(a){_.each(this.$children,function(b){if(!_.isUndefined(a)&&b.sentIndex===a.sentIndex){b.highlightStatus={active:b.syntagmaIndex===a.syntagmaIndex,subject:b.syntagmaIndex===a.syntagma.subject,object:b.syntagmaIndex===a.syntagma.object,dependent:_.contains(a.syntagma.jurisdiction,b.syntagmaIndex)}}else{b.highlightStatus={active:false,subject:false,object:false,dependent:false}}})}},methods:{toggleMobileParagraphInfo:function(){if(this.showingMobileAnnotations){this.showingMobileAnnotations=false}else{this.$parent.$broadcast("resetMobileAnnotations");this.showingMobileAnnotations=true;var a=this.$el.querySelector(".mobile-only .zoom");_.delay(function(){var d=getStyle(document.getElementById("output"),"padding-top"),c=a.parentNode.parentNode.parentNode,b=document.body.scrollTop+c.getBoundingClientRect().top-d-20;zenscroll.toY(b)},400)}},toggleFullParagraphInfo:function(){if(this.showingParagraphInfo){this.showingParagraphInfo=false}else{this.$parent.$emit("hideHelp");this.$parent.$broadcast("reset");this.$parent.$broadcast("noLabels");this.showingParagraphInfo=true}},copyRevision:function(){this.copyboxExists=true;var a=this;_.defer(function(){a.$el.querySelector(".copybox input").select();try{var c=document.execCommand("copy")||copy(getSelection().toString());if(c){a.copyboxExists=false;a.showingSuccessbox=true;_.delay(function(){a.showingSuccessbox=false},750);return true}}catch(b){}if(a.showingCopybox){a.showingCopybox=false;_.delay(function(){a.copyboxExists=false},300)}else{a.showingCopybox=true}})},destroyCopybox:function(){this.showingCopybox=false;this.copyboxExists=false}},props:["paraIndex","paragraph","totalParagraphs"]});var myVue=new Vue({el:"#app",data:{input:"",paragraphs:[],waitingForAPI:false,speechRecognizer:undefined,isListeningToVoice:false,finalTranscript:"",inactiveParagraphs:[],demoData:[],demoMode:false,demoAppend:true,helpIsOn:false,language:"en",help:helpTranslations},components:{paragraph:Paragraph},computed:{totalParagraphs:function(){return this.paragraphs.length}},events:{clearInput:function(){var a=this;_.delay(function(){a.input=""},100)},hideHelp:function(){this.helpIsOn=false}},ready:function(){if(/Android/.test(navigator.userAgent)){}else{if(window.webkitSpeechRecognition){this.speechRecognizer=new webkitSpeechRecognition();this.speechRecognizer.continuous=true;this.speechRecognizer.interimResults=false;this.speechRecognizer.onstart=function(){myVue.isListeningToVoice=true};this.speechRecognizer.onerror=function(a){};this.speechRecognizer.onend=function(){myVue.isListeningToVoice=false;if(!myVue.finalTranscript){return}};this.speechRecognizer.onresult=function(b){for(var a=b.resultIndex;a<b.results.length;++a){if(b.results[a].isFinal){myVue.finalTranscript+=b.results[a][0].transcript}else{}}myVue.input=myVue.finalTranscript}}}},methods:{reset:function(a){if(isDescendantOfClass(a.target,"annotation-block")||a.target.classList.contains("zoom")){return false}this.$broadcast("reset");if("ontouchstart" in document.documentElement){this.$broadcast("noLabels")}},loadDemoData:function(){if(!/demodata/.test(document.getElementsByTagName("script")[0].src)){this.waitingForAPI=true;var b=document.createElement("script");b.src="/js/claire.demodata.js";b.type="text/javascript";b.async=true;var a=document.getElementsByTagName("head")[0];a.appendChild(b)}if(typeof claireDemoData==="object"){this.waitingForAPI=false;this.demoData=_.shuffle(claireDemoData);this.toggleDemoMode()}else{window.setTimeout(myVue.loadDemoData,100)}},toggleDemoMode:function(a){if(!_.isUndefined(a)){if(a.target.classList.contains("copy")||a.srcEvent.ctrlKey===true){return}}if(this.demoMode){this.demoMode=false;this.demoData=_.compact(this.demoData.concat(this.paragraphs));this.paragraphs=this.inactiveParagraphs;this.inactiveParagraphs=[]}else{if(!this.demoData.length){this.loadDemoData()}else{this.demoMode=true;this.inactiveParagraphs=this.paragraphs;this.paragraphs=[]}}},toggleVoice:function(){if(!this.speechRecognizer){return false}if(this.isListeningToVoice){this.speechRecognizer.stop();return}this.finalTranscript="";this.speechRecognizer.lang="en-US";this.speechRecognizer.start()},addParagraph:function(b){_.defer(function(){if(/\n$/.test(myVue.input)){myVue.input=myVue.input.slice(0,-1)}myVue.input=myVue.input.trim()});if(this.demoMode){if(b.keyCode===13){alert("To enter your own sentences, please exit demo mode.");this.$emit("clearInput");return}this.$broadcast("reset");this.$broadcast("resetMobileAnnotations");if(this.demoAppend){this.paragraphs.unshift(this.demoData.shift());if(!this.demoData.length){this.demoAppend=false}}else{this.demoData.unshift(this.paragraphs.shift());if(!this.paragraphs.length){this.demoAppend=true}}return}if(this.waitingForAPI){return true}var a=this.input;a.replace(/<.*?>/ig,"");if(a.length>1000){alert("Please shorten your text to 1000 characters or less.");return true}else{if(a.split(" ").length<3){alert("Please type in a sentence of three or more words.");if(!/\w/.test(a)){this.$emit("clearInput")}return true}}this.waitingForAPI=true;this.$http({url:claireApiServer,data:{text:a},method:"GET"}).then(function(c){if(typeof(c.data)==="object"){myVue.$broadcast("reset");myVue.$broadcast("resetMobileAnnotations");myVue.paragraphs.unshift(c.data);myVue.$emit("clearInput");_.defer(smartquotes)}else{if(c.data=="NOT_ENGLISH"){alert("Sorry, Claire only understands English.")}else{if(c.data=="INPUT_TOO_SHORT"){alert("Please type in a sentence of three or more words.")}else{if(c.data=="CLAIRE_IS_SLEEPING"){alert("Sorry, Claire seems to be sleeping at the moment. Try again later.")}else{if(c.data=="IGNORE_REQUEST"){}else{if(c.data=="CLAIRE_BUG"){alert("Whoops! It looks like you found a bug in Claire. Your text has been logged. Try modifying your sentence a little bit and try again.")}}}}}}myVue.waitingForAPI=false;document.getElementById("input-box").blur();zenscroll.toY(0);hideBlanket();lazyResize()},function(c){console.log(c.status,c.statusText);document.getElementById("input-box").blur();myVue.waitingForAPI=false;alert("The server could not be reached. Please check your Internet connection or try again later.")})},panLanguages:_panLanguages,switchLang:_switchLang,toggleHelp:function(){document.getElementById("input-box").blur();if(this.helpIsOn){this.helpIsOn=false}else{this.helpIsOn=true;var a=this;_.defer(function(){a.switchLang(a.language)})}}}});window.addEventListener("load",resizeInput);window.addEventListener("resize",lazyResize);window.addEventListener("orientationchange",resizeInput);document.querySelector("#input-right .bubble").addEventListener("click",function(a){if(a.target===this){focusOnInput()}});var inputBox=document.getElementById("input-box");inputBox.addEventListener("keyup",function(a){this.value?focusOnInput():hideBlanket();lazyResize()});blanket.addEventListener("touchstart",function(){inputBox.blur()});document.documentElement.classList.remove("no-fouc");